import{r as o,g as L,f as Q,e as w,j as e,B as U}from"./index-BvrU90Mr.js";import{L as u,I as p,T as W,g as X}from"./matching-CfRSpC8f.js";function ae(){const[t,x]=o.useState({title:"",imageUrl:"",category:L[1]??"AI/ML",description:"",skills:"",duration:"",tags:"",contact:""}),[A,F]=o.useState(L),[N,D]=o.useState(null),[T,M]=o.useState(""),[S,$]=o.useState(""),[b,_]=o.useState(""),[C,y]=o.useState(!1),[B,v]=o.useState(""),[P,q]=o.useState(!1),[G,R]=o.useState(!1),[Y,J]=o.useState(!1),[O,V]=o.useState(null),[Z,ee]=o.useState(null),h=(t.description||"").trim().length>0,z=s=>s.replace(/\s+/g," ").trim().split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "),E=(s,i=2)=>{const r=[],a=new Set;for(const l of s){const n=String(l||"").toLowerCase().trim().replace(/\s+/g," ");if(!(!n||n.split(" ").length>2)&&!a.has(n)&&(a.add(n),r.push(n),r.length>=i))break}return r},I=(s,i=2)=>{const r=[],a=new Set;for(const l of s){const n=String(l||"").replace(/\s+/g," ").trim();if(!n||n.split(" ").length>3)continue;const m=n.toLowerCase();if(!a.has(m)&&(a.add(m),r.push(z(n)),r.length>=i))break}return r},j=(s,i,r,a=2)=>{const l=r(s.split(",").map(c=>c.trim()).filter(Boolean)),n=r(i),g=[],m=new Set;for(const c of[...l,...n]){const d=c.toLowerCase();if(!m.has(d)&&(m.add(d),g.push(c),g.length>=a))break}return g.join(", ")},f=s=>{const{name:i,value:r}=s.target;i==="category"&&q(!0),i==="tags"&&R(!0),i==="skills"&&J(!0),x(a=>({...a,[i]:r}))};o.useEffect(()=>{let s=!1;return(async()=>{try{const i=await Q();if(!s&&Array.isArray(i.givesCategories)&&i.givesCategories.length&&(F(i.givesCategories),!i.givesCategories.includes(t.category))){const r=i.givesCategories.find(a=>a!=="전체")||i.givesCategories[0];r&&x(a=>({...a,category:r}))}}catch{}})(),()=>{s=!0}},[]);const K=async()=>{y(!0),v("");try{const s=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(a=>a.trim()).filter(Boolean),tags:t.tags.split(",").map(a=>a.trim()).filter(Boolean),category:t.category}),i=j(t.tags,s.tags||[],a=>E(a),2),r=j(t.skills,s.skills||[],a=>I(a),2);x(a=>({...a,category:s.suggestedCategory||a.category,tags:i,skills:r})),v(`추천 카테고리: ${s.suggestedCategory??"없음"} · 추천 태그 ${s.tags?.length??0}개 (신뢰도 ${Math.round((s.confidence||0)*100)}%)`)}catch{v("⚠️ 추천 서버에 연결하지 못했습니다. 서버를 실행하거나 VITE_API_BASE를 설정하세요.")}finally{y(!1)}};o.useEffect(()=>{O||V(t);const s=12,i=(t.description||"").trim(),r=(t.title||"").trim();if(C||i.length<s&&r.length<s)return;const a=setTimeout(async()=>{try{y(!0);const l=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(n=>n.trim()).filter(Boolean),tags:t.tags.split(",").map(n=>n.trim()).filter(Boolean),category:t.category});v(`추천 카테고리: ${l.suggestedCategory??"없음"} · 추천 태그 ${l.tags?.length??0}개 (신뢰도 ${Math.round((l.confidence||0)*100)}%)`),x(n=>{const g=G?n.tags:j(n.tags,l.tags||[],c=>E(c),2),m=Y?n.skills:j(n.skills,l.skills||[],c=>I(c),2);return{...n,category:P?n.category:l.suggestedCategory||n.category,tags:g,skills:m}})}catch{v("⚠️ 추천 서버에 연결하지 못했습니다. 서버를 실행하거나 VITE_API_BASE를 설정하세요.")}finally{y(!1)}},700);return()=>clearTimeout(a)},[t.description,t.title,t.skills]);const H=async s=>{s.preventDefault();let i,r=[];try{const d=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(k=>k.trim()).filter(Boolean),tags:t.tags.split(",").map(k=>k.trim()).filter(Boolean),category:t.category});i=d.suggestedCategory||void 0,r=d.tags||[]}catch{}const a=i||t.category,l=Array.from(new Set([...r||[],...t.tags.split(",").map(d=>d.trim()).filter(Boolean)])),n={id:`give-${Date.now()}`,isCustom:!0,title:t.title.trim(),imageUrl:t.imageUrl.trim()||"https://images.unsplash.com/photo-1638202677704-b74690bb8fa9?w=1080&q=80&auto=format&fit=crop",category:a,description:t.description.trim(),skills:t.skills.split(",").map(d=>d.trim()).filter(Boolean),duration:S&&b?`${S} ~ ${b}`:t.duration.trim()||void 0,contact:t.contact?.trim()||void 0,tags:l,matchingTags:X({type:"gives",category:a,title:t.title,description:t.description,skills:t.skills.split(",").map(d=>d.trim()).filter(Boolean),tags:l}),llmCategory:i,llmTags:r},g="custom_gives",m=localStorage.getItem(g),c=m?JSON.parse(m):[];c.unshift(n),localStorage.setItem(g,JSON.stringify(c)),D(n.id),window.dispatchEvent(new Event("data:updated"))};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-6",children:[e.jsx("h2",{className:"font-['Inter:Semi_Bold','Noto_Sans_KR:Bold',sans-serif] text-[26px] mb-1 text-gray-900",children:"솔루션 제공하기"}),N?e.jsxs("div",{className:"rounded-md border border-green-200 bg-green-50 p-4 text-green-800",children:["솔루션이 저장되었습니다. 새로고침하면 리스트에 반영됩니다. (ID: ",N,")"]}):e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"제목"}),e.jsx(p,{id:"title",name:"title",value:t.title,onChange:f,required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"imageFile",children:"이미지 업로드"}),e.jsx(p,{id:"imageFile",type:"file",accept:"image/*",onChange:s=>{const i=s.target.files?.[0];if(!i)return;const r=new FileReader;r.onload=()=>{const a=String(r.result||"");x(l=>({...l,imageUrl:a})),M(a)},r.readAsDataURL(i)}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JPG/PNG 권장, 최대 2MB, 권장 비율 16:9"}),T||t.imageUrl?e.jsx("img",{src:T||t.imageUrl,alt:"preview",className:"mt-2 w-[160px] h-[114px] object-cover rounded"}):null]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"설명"}),e.jsx(W,{id:"description",name:"description",value:t.description,onChange:f,rows:5,required:!0}),!h&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"설명을 먼저 입력하면 나머지 항목을 작성할 수 있어요."})]}),h&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:K,disabled:C,className:"w-full h-12 bg-gradient-to-r from-orange-50 to-orange-100 border-orange-200 text-orange-900 hover:from-orange-100 hover:to-orange-200 transition-all duration-200",children:C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-orange-600 border-t-transparent rounded-full"}),"LLM으로 하단 내용 채우는 중..."]}):"👇🏻 LLM으로 하단 내용 채우기 (카테고리, 스킬, 태그 자동 추천) 👇🏻"}),B&&e.jsx("div",{className:"mt-2 p-2 bg-orange-50 rounded text-sm text-orange-800",children:B})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"category",children:"카테고리"}),e.jsx("select",{id:"category",name:"category",value:t.category,onChange:f,className:"h-9 w-full rounded-md border px-3 text-sm bg-white",disabled:!h,children:A.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"제공 기간"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"예: 2025.10.23",value:S,onChange:s=>$(s.target.value),disabled:!h}),e.jsx("span",{className:"self-center text-gray-500",children:"~"}),e.jsx(p,{placeholder:"예: 2025.10.30",value:b,onChange:s=>_(s.target.value),disabled:!h})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"형식: YYYY.MM.DD"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(u,{htmlFor:"contact",children:"연락처"}),e.jsx(p,{id:"contact",name:"contact",required:!0,onChange:f,placeholder:"예: 카카오톡 @username, 이메일 hello@example.com",disabled:!h})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"skills",children:"핵심 기능/스킬 (쉼표 구분)"}),e.jsx(p,{id:"skills",name:"skills",value:t.skills,onChange:f,placeholder:"예: 자동 차단, 실시간 모니터링",disabled:!h})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"tags",children:"태그 (쉼표 구분)"}),e.jsx(p,{id:"tags",name:"tags",value:t.tags,onChange:f,placeholder:"예: AI/ML, 교육",disabled:!h})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{type:"submit",className:"bg-orange-600 hover:bg-orange-700",disabled:!h,children:"저장"}),e.jsx("a",{href:"#",className:"text-sm text-gray-600 hover:underline",children:"취소"})]})]})]})}export{ae as ProvideSolution,ae as default};
