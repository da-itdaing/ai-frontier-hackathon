import{r as o,n as L,f as Q,e as w,j as e,B as U}from"./index-BvrU90Mr.js";import{L as h,I as p,T as W,g as X}from"./matching-CfRSpC8f.js";function ae(){const[F,D]=o.useState(L),[t,f]=o.useState({title:"",imageUrl:"",category:L[1]??"환경",description:"",skills:"",duration:"",tags:"",contact:""}),[N,A]=o.useState(null),[T,$]=o.useState(""),[v,M]=o.useState(""),[S,_]=o.useState(""),[C,j]=o.useState(!1),[B,y]=o.useState(""),[P,q]=o.useState(!1),[R,Y]=o.useState(!1),[J,O]=o.useState(!1),[G,V]=o.useState(null),[Z,ee]=o.useState(null),u=(t.description||"").trim().length>0,z=s=>s.replace(/\s+/g," ").trim().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "),E=(s,r=2)=>{const i=[],a=new Set;for(const n of s){const l=String(n||"").toLowerCase().trim().replace(/\s+/g," ");if(!(!l||l.split(" ").length>2)&&!a.has(l)&&(a.add(l),i.push(l),i.length>=r))break}return i},I=(s,r=2)=>{const i=[],a=new Set;for(const n of s){const l=String(n||"").replace(/\s+/g," ").trim();if(!l||l.split(" ").length>3)continue;const m=l.toLowerCase();if(!a.has(m)&&(a.add(m),i.push(z(l)),i.length>=r))break}return i},b=(s,r,i,a=2)=>{const n=i(s.split(",").map(c=>c.trim()).filter(Boolean)),l=i(r),g=[],m=new Set;for(const c of[...n,...l]){const d=c.toLowerCase();if(!m.has(d)&&(m.add(d),g.push(c),g.length>=a))break}return g.join(", ")},x=s=>{const{name:r,value:i}=s.target;r==="category"&&q(!0),r==="tags"&&Y(!0),r==="skills"&&O(!0),f(a=>({...a,[r]:i}))};o.useEffect(()=>{let s=!1;return(async()=>{try{const r=await Q();if(!s&&Array.isArray(r.needsCategories)&&r.needsCategories.length&&(D(r.needsCategories),!r.needsCategories.includes(t.category))){const i=r.needsCategories.find(a=>a!=="전체")||r.needsCategories[0];i&&f(a=>({...a,category:i}))}}catch{}})(),()=>{s=!0}},[]);const H=async s=>{s.preventDefault();let r,i=[];try{const d=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(k=>k.trim()).filter(Boolean),tags:t.tags.split(",").map(k=>k.trim()).filter(Boolean),category:t.category});r=d.suggestedCategory||void 0,i=d.tags||[]}catch{}const a=r||t.category,n=Array.from(new Set([...i||[],...t.tags.split(",").map(d=>d.trim()).filter(Boolean)])),l={id:`need-${Date.now()}`,isCustom:!0,title:t.title.trim(),imageUrl:t.imageUrl.trim()||"https://images.unsplash.com/photo-1603575448878-868a20723f5d?w=1080&q=80&auto=format&fit=crop",category:a,description:t.description.trim(),skills:t.skills.split(",").map(d=>d.trim()).filter(Boolean),duration:v&&S?`${v} ~ ${S}`:t.duration.trim()||void 0,contact:t.contact?.trim()||void 0,tags:n,matchingTags:X({type:"needs",category:a,title:t.title,description:t.description,skills:t.skills.split(",").map(d=>d.trim()).filter(Boolean),tags:n}),llmCategory:r,llmTags:i},g="custom_needs",m=localStorage.getItem(g),c=m?JSON.parse(m):[];c.unshift(l),localStorage.setItem(g,JSON.stringify(c)),A(l.id),window.dispatchEvent(new Event("data:updated"))},K=async()=>{j(!0),y("");try{const s=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(a=>a.trim()).filter(Boolean),tags:t.tags.split(",").map(a=>a.trim()).filter(Boolean),category:t.category}),r=b(t.tags,s.tags||[],a=>E(a,2),2),i=b(t.skills,s.skills||[],a=>I(a,2),2);f(a=>({...a,category:s.suggestedCategory||a.category,tags:r,skills:i})),y(`추천 카테고리: ${s.suggestedCategory??"없음"} · 추천 태그 ${s.tags?.length??0}개 (신뢰도 ${Math.round((s.confidence||0)*100)}%)`)}catch{y("⚠️ 추천 서버에 연결하지 못했습니다. 서버를 실행하거나 VITE_API_BASE를 설정하세요.")}finally{j(!1)}};return o.useEffect(()=>{G||V(t);const s=12,r=(t.description||"").trim(),i=(t.title||"").trim();if(C||r.length<s&&i.length<s)return;const a=setTimeout(async()=>{try{j(!0);const n=await w({title:t.title,description:t.description,skills:t.skills.split(",").map(l=>l.trim()).filter(Boolean),tags:t.tags.split(",").map(l=>l.trim()).filter(Boolean),category:t.category});y(`추천 카테고리: ${n.suggestedCategory??"없음"} · 추천 태그 ${n.tags?.length??0}개 (신뢰도 ${Math.round((n.confidence||0)*100)}%)`),f(l=>{const g=R?l.tags:b(l.tags,n.tags||[],c=>E(c,2),2),m=J?l.skills:b(l.skills,n.skills||[],c=>I(c,2),2);return{...l,category:P?l.category:n.suggestedCategory||l.category,tags:g,skills:m}})}catch{y("⚠️ 추천 서버에 연결하지 못했습니다. 서버를 실행하거나 VITE_API_BASE를 설정하세요.")}finally{j(!1)}},700);return()=>clearTimeout(a)},[t.description,t.title,t.skills]),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-6",children:[e.jsx("h2",{className:"font-['Inter:Semi_Bold','Noto_Sans_KR:Bold',sans-serif] text-[26px] mb-1 text-gray-900",children:"도움 요청하기"}),N?e.jsxs("div",{className:"rounded-md border border-green-200 bg-green-50 p-4 text-green-800",children:["요청이 저장되었습니다. 새로고침하면 리스트에 반영됩니다. (ID: ",N,")"]}):e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"title",children:"제목"}),e.jsx(p,{id:"title",name:"title",value:t.title,onChange:x,required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"imageFile",children:"이미지 업로드"}),e.jsx(p,{id:"imageFile",type:"file",accept:"image/*",onChange:s=>{const r=s.target.files?.[0];if(!r)return;const i=new FileReader;i.onload=()=>{const a=String(i.result||"");f(n=>({...n,imageUrl:a})),$(a)},i.readAsDataURL(r)}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JPG/PNG 권장, 최대 2MB, 권장 비율 16:9"}),T||t.imageUrl?e.jsx("img",{src:T||t.imageUrl,alt:"preview",className:"mt-2 w-[160px] h-[114px] object-cover rounded"}):null]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"설명"}),e.jsx(W,{id:"description",name:"description",value:t.description,onChange:x,rows:5,required:!0}),!u&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"설명을 먼저 입력하면 나머지 항목을 작성할 수 있어요."})]}),u&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:K,disabled:C,className:"w-full h-12 bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200 text-blue-900 hover:from-blue-100 hover:to-blue-200 transition-all duration-200",children:C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full"}),"LLM으로 하단 내용 채우는 중..."]}):"👇🏻 LLM으로 하단 내용 채우기 (카테고리, 스킬, 태그 자동 추천) 👇🏻"}),B&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded text-sm text-blue-800",children:B})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"category",children:"카테고리"}),e.jsx("select",{id:"category",name:"category",value:t.category,onChange:x,className:"h-9 w-full rounded-md border px-3 text-sm bg-white",disabled:!u,children:F.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(h,{children:"기간"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"예: 2025.10.23",value:v,onChange:s=>M(s.target.value),disabled:!u}),e.jsx("span",{className:"self-center text-gray-500",children:"~"}),e.jsx(p,{placeholder:"예: 2025.10.30",value:S,onChange:s=>_(s.target.value),disabled:!u})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"형식: YYYY.MM.DD"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"skills",children:"필요 스킬 (쉼표 구분)"}),e.jsx(p,{id:"skills",name:"skills",value:t.skills,onChange:x,placeholder:"예: 음성 안내, 안전 보행",disabled:!u})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"tags",children:"태그 (쉼표 구분)"}),e.jsx(p,{id:"tags",name:"tags",value:t.tags,onChange:x,placeholder:"예: 교육, 안전",disabled:!u})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{htmlFor:"contact",children:"연락처"}),e.jsx(p,{id:"contact",name:"contact",required:!0,onChange:x,placeholder:"예: 카카오톡 @username, 이메일 hello@example.com",disabled:!u})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:!u,children:"저장"}),e.jsx("a",{href:"#",className:"text-sm text-gray-600 hover:underline",children:"취소"})]})]})]})}export{ae as RequestHelp};
